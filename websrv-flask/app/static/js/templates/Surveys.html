<ew-load loading="loading">
    <div class="row" ng-if="(!surveys || (surveys.length == 0)) && !error">
        <div class="alert alert-info">You have no surveys yet!</div>
    </div>
    <div class="row" ng-repeat="survey in surveys">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title" ng-click="startEditing('surveyname', $event, survey.fields.name)" ng-if="!isEditing('surveyname')">{{ survey.fields.name }}</h3>
                <input type="text" class="form-control" id="inputSurveyName" data-uuid="{{ survey.uuid }}" ng-model="survey.fields.name" ng-enter="stopEditing('surveyname', $event, survey)" ng-blur="abortEditing('surveyname', $event, survey)" ng-if="isEditing('surveyname')">
            </div>
            <div class="panel-body">
                <div class="list-group">
                    <ngRepeat ng-repeat="questionnaire in survey.fields.questionnaires">
                        <div class="list-group-item col-sm-1 as-checkbox" ng-click="toggleSelect(survey, questionnaire)" ng-class="{'list-group-item-info': selection.questionnaires[questionnaire.uuid] == true}">
                        </div>
                        <a class="list-group-item col-sm-11 selectable">
                            <div class="btn-group col-sm-3" role="group">
                                <button type="button" class="btn btn-default" click-go="/surveys/{{ questionnaire.uuid }}/statistic">{{ questionnaire.fields.answer_count || 0 }} Results</button>
                                <button type="button" class="btn btn-default" ng-click="gotoQuestionnaire(questionnaire)">Open</button>
                                <button type="button" class="btn btn-default edit-button" click-go="/surveys/{{ questionnaire.uuid }}">Edit</button>
                            </div>
                            <h4 class="list-group-item-heading" ng-click="startEditing('questionnairename', $event, questionnaire.fields.name)" ng-if="!isEditing('questionnairename') && !isEditing('questionnairedescription')">{{ questionnaire.fields.name }}</h4>
                            <p class="list-group-item-text" ng-click="startEditing('questionnairedescription', $event, questionnaire.fields.description)" ng-if="!isEditing('questionnairename') && !isEditing('questionnairedescription')">{{ questionnaire.fields.description }}</p>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="inputQuestionnaireName" data-uuid="{{ questionnaire.uuid }}" ng-model="questionnaire.fields.name" ng-enter="stopEditing('questionnairename', $event, questionnaire)" ng-blur="abortEditing('questionnairename', $event, questionnaire)" ng-if="isEditing('questionnairename')">
                                <input type="text" class="form-control" id="inputQuestionnaireDescription" data-uuid="{{ questionnaire.uuid }}" ng-model="questionnaire.fields.description" ng-enter="stopEditing('questionnairedescription', $event, questionnaire)" ng-blur="abortEditing('questionnairedescription', $event, questionnaire)" ng-if="isEditing('questionnairedescription')">
                            </div>
                        </a>
                    </ngRepeat>
                </div>
            </div>
            <div class="panel-footer">
                <form class="form-horizontal" ng-if="new.questionnaire.survey == survey">
                    <div class="form-group">
                        <label for="inputQuestionnaireName" class="col-sm-2 control-label">Name</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="inputQuestionnaireName" ng-model="new.questionnaire.data.name" ng-enter="createQuestionnaire()">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputQuestionnaireDescription" class="col-sm-2 control-label">Description</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="inputQuestionnaireDescription" ng-model="new.questionnaire.data.description" ng-enter="createQuestionnaire()">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="selectQuestionnaireTemplate" class="col-sm-2 control-label">Use Template</label>
                        <div class="col-sm-10">
                            <select class="form-control" id="selectQuestionnaireTemplate" ng-model="new.questionnaire.data.template">
                                <option ng-repeat="template in templates" value="{{ template.value }}">{{ template.name }}</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="buttonQuestionnaireCreate" class="col-sm-2 control-label"></label>
                        <div class="col-sm-2">
                            <button type="button" id="buttonQuestionnaireCreate" class="form-control btn btn-default" ng-click="createQuestionnaire()">Create</button>
                        </div>
                        <div class="col-sm-2">
                            <button type="button" id="buttonQuestionnaireCancel" class="form-control btn btn-default" ng-click="resetEditing()">Cancel</button>
                        </div>
                    </div>
                </form>
                <button type="button" class="btn btn-default btn-success" ng-click="newQuestionnaire(survey)" ng-if="new.questionnaire.survey != survey">
                    Add new Questionnaire to this survey...
                </button>
                <button type="button" class="btn btn-default btn-warning" mw-confirm-click="deleteQuestionnaires(survey)" mw-confirm-message="Are you sure you want to delete the selected {{ selection.count }} Questionnaires?" ng-if="selection.survey == survey">
                    Remove the selected {{ selection.count }} Questionnaires from this Survey...
                </button>
                <button type="button" class="btn btn-default btn-danger pull-right" mw-confirm-click="deleteSurvey(survey)" mw-confirm-message="Are you sure you want to delete the survey '{{ survey.fields.name }}'?">
                    Delete this Survey...
                </button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="input-group" ng-if="new.survey.data != null">
            <span class="input-group-btn">
                <button class="btn btn-default" type="button" ng-click="createSurvey()">Create</button>
            </span>
            <input type="text" class="form-control" ng-model="new.survey.data.name" ng-enter="createSurvey()" />
            <span class="input-group-btn">
                <button class="btn btn-default" type="button" ng-click="resetEditing()">Cancel</button>
            </span>
        </div>
        <button type="button" class="btn btn-default" ng-click="newSurvey()" ng-if="new.survey.data == null">
            Add new Survey...
        </button>
    </div>
</ew-load>
